<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="https://github.com/jhnns/rewire"

    >rewire (v2.5.2)</a>
</h1>
<h4>Easy dependency injection for node.js unit testing</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.rewire">module rewire</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.rewire.rewire">
            function <span class="apidocSignatureSpan"></span>rewire
            <span class="apidocSignatureSpan">(filename)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">rewire.</span>moduleA</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">rewire.</span>moduleB</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">rewire.</span>moduleEnv</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">rewire.</span>strictModule</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.rewire.moduleA">module rewire.moduleA</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.rewire.moduleA.checkSomeGlobals">
            function <span class="apidocSignatureSpan">rewire.moduleA.</span>checkSomeGlobals
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.rewire.moduleA.getBuffer">
            function <span class="apidocSignatureSpan">rewire.moduleA.</span>getBuffer
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.rewire.moduleA.getConsole">
            function <span class="apidocSignatureSpan">rewire.moduleA.</span>getConsole
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.rewire.moduleA.getDocument">
            function <span class="apidocSignatureSpan">rewire.moduleA.</span>getDocument
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.rewire.moduleA.getFilename">
            function <span class="apidocSignatureSpan">rewire.moduleA.</span>getFilename
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.rewire.moduleA.getMyNumber">
            function <span class="apidocSignatureSpan">rewire.moduleA.</span>getMyNumber
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.rewire.moduleA.getMyObj">
            function <span class="apidocSignatureSpan">rewire.moduleA.</span>getMyObj
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.rewire.moduleA.readFileSync">
            function <span class="apidocSignatureSpan">rewire.moduleA.</span>readFileSync
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.rewire.moduleA.setMyNumber">
            function <span class="apidocSignatureSpan">rewire.moduleA.</span>setMyNumber
            <span class="apidocSignatureSpan">(newNumber)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.rewire.moduleA.setMyObj">
            function <span class="apidocSignatureSpan">rewire.moduleA.</span>setMyObj
            <span class="apidocSignatureSpan">(newObj)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">rewire.moduleA.</span>someOtherModule</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.rewire.moduleB">module rewire.moduleB</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.rewire.moduleB.checkSomeGlobals">
            function <span class="apidocSignatureSpan">rewire.moduleB.</span>checkSomeGlobals
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.rewire.moduleB.getBuffer">
            function <span class="apidocSignatureSpan">rewire.moduleB.</span>getBuffer
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.rewire.moduleB.getConsole">
            function <span class="apidocSignatureSpan">rewire.moduleB.</span>getConsole
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.rewire.moduleB.getDocument">
            function <span class="apidocSignatureSpan">rewire.moduleB.</span>getDocument
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.rewire.moduleB.getFilename">
            function <span class="apidocSignatureSpan">rewire.moduleB.</span>getFilename
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.rewire.moduleB.getMyNumber">
            function <span class="apidocSignatureSpan">rewire.moduleB.</span>getMyNumber
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.rewire.moduleB.getMyObj">
            function <span class="apidocSignatureSpan">rewire.moduleB.</span>getMyObj
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.rewire.moduleB.readFileSync">
            function <span class="apidocSignatureSpan">rewire.moduleB.</span>readFileSync
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.rewire.moduleB.setMyNumber">
            function <span class="apidocSignatureSpan">rewire.moduleB.</span>setMyNumber
            <span class="apidocSignatureSpan">(newNumber)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.rewire.moduleB.setMyObj">
            function <span class="apidocSignatureSpan">rewire.moduleB.</span>setMyObj
            <span class="apidocSignatureSpan">(newObj)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">rewire.moduleB.</span>someOtherModule</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.rewire.moduleEnv">module rewire.moduleEnv</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.rewire.moduleEnv.inject">
            function <span class="apidocSignatureSpan">rewire.moduleEnv.</span>inject
            <span class="apidocSignatureSpan">(prelude, appendix)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.rewire.moduleEnv.load">
            function <span class="apidocSignatureSpan">rewire.moduleEnv.</span>load
            <span class="apidocSignatureSpan">(targetModule)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.rewire.strictModule">module rewire.strictModule</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.rewire.strictModule.doSomethingUnstrict">
            function <span class="apidocSignatureSpan">rewire.strictModule.</span>doSomethingUnstrict
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.rewire" id="apidoc.module.rewire">module rewire</a></h1>


    <h2>
        <a href="#apidoc.element.rewire.rewire" id="apidoc.element.rewire.rewire">
        function <span class="apidocSignatureSpan"></span>rewire
        <span class="apidocSignatureSpan">(filename)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function rewire(filename) {
    return rewireModule(module.parent, filename);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>










</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.rewire.moduleA" id="apidoc.module.rewire.moduleA">module rewire.moduleA</a></h1>


    <h2>
        <a href="#apidoc.element.rewire.moduleA.checkSomeGlobals" id="apidoc.element.rewire.moduleA.checkSomeGlobals">
        function <span class="apidocSignatureSpan">rewire.moduleA.</span>checkSomeGlobals
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function checkSomeGlobals() {
    var isLowerIE,
        typeOfGlobalFunc;

    if (typeof navigator !== &#x22;undefined&#x22;) {
        isLowerIE = /MSIE [6-8]\.[0-9]/g.test(navigator.userAgent);
    }
    if (isLowerIE) {
        typeOfGlobalFunc = &#x22;object&#x22;;
    } else {
        typeOfGlobalFunc = &#x22;function&#x22;;
    }

    if (typeof global !== &#x22;object&#x22;) {
        throw new ReferenceError(&#x22;global is not an object&#x22;);
    }
    if (typeof console !== &#x22;object&#x22;) {
        throw new ReferenceError(&#x22;console is not an object&#x22;);
    }
    if (typeof require !== &#x22;function&#x22;) {
        throw new ReferenceError(&#x22;require is not a function&#x22;);
    }
    if (typeof module !== &#x22;object&#x22;) {
        throw new ReferenceError(&#x22;module is not an object&#x22;);
    }
    if (typeof exports !== &#x22;object&#x22;) {
        throw new ReferenceError(&#x22;exports is not an object&#x22;);
    }
    if (module.exports !== exports) {
        throw new Error(&#x22;module.exports === exports returns false&#x22;);
    }
    if (typeof __dirname !== &#x22;string&#x22;) {
        throw new ReferenceError(&#x22;__dirname is not a string&#x22;);
    }
    if (typeof __filename !== &#x22;string&#x22;) {
        throw new ReferenceError(&#x22;__filename is not a string&#x22;);
    }
    if (typeof setTimeout !== typeOfGlobalFunc) {
        throw new ReferenceError(&#x22;setTimeout is not a function&#x22;);
    }
    if (typeof clearTimeout !== typeOfGlobalFunc) {
        throw new ReferenceError(&#x22;clearTimeout is not a function&#x22;);
    }
    if (typeof setInterval !== typeOfGlobalFunc) {
        throw new ReferenceError(&#x22;setInterval is not a function&#x22;);
    }
    if (typeof clearInterval !== typeOfGlobalFunc) {
        throw new ReferenceError(&#x22;clearInterval is not a function&#x22;);
    }
    if (typeof Error !== &#x22;function&#x22;) {
        throw new ReferenceError(&#x22;Error is not a function&#x22;);
    }
    if (typeof parseFloat !== &#x22;function&#x22;) {
        throw new ReferenceError(&#x22;parseFloat is not a function&#x22;);
    }
    if (typeof parseInt !== &#x22;function&#x22;) {
        throw new ReferenceError(&#x22;parseInt is not a function&#x22;);
    }
    if (typeof window === &#x22;undefined&#x22;) {
        if (typeof process !== &#x22;object&#x22;) {
            throw new ReferenceError(&#x22;process is not an object&#x22;);
        }
        if (typeof Buffer !== &#x22;function&#x22;) {
            throw new ReferenceError(&#x22;Buffer is not a function&#x22;);
        }
    } else {
        if (typeof encodeURIComponent !== &#x22;function&#x22;) {
            throw new ReferenceError(&#x22;encodeURIComponent is not a function&#x22;);
        }
        if (typeof decodeURIComponent !== &#x22;function&#x22;) {
            throw new ReferenceError(&#x22;decodeURIComponent is not a function&#x22;);
        }
        if (typeof document !== &#x22;object&#x22;) {
            throw new ReferenceError(&#x22;document is not an object&#x22;);
        }
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    expect(require(&#x22;./someOtherModule.js&#x22;).__set__).to.be(undefined);
    expect(require(&#x22;./someOtherModule.js&#x22;).__get__).to.be(undefined);
    expect(require(&#x22;./someOtherModule.js&#x22;).__with__).to.be(undefined);
});

it(&#x22;should not override/influence global objects by default&#x22;, function () {
    // This should throw no exception
    rewire(&#x22;./moduleA.js&#x22;).<span class="apidocCodeKeywordSpan">checkSomeGlobals</span>();
    rewire(&#x22;./moduleB.js&#x22;).checkSomeGlobals();
});

// This is just an integration test for the __set__ method
// You can find a full test for __set__ under /test/__set__.test.js
it(&#x22;should provide a working __set__ method&#x22;, function () {
    var rewiredModuleA = rewire(&#x22;./moduleA.js&#x22;),
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.rewire.moduleA.getBuffer" id="apidoc.element.rewire.moduleA.getBuffer">
        function <span class="apidocSignatureSpan">rewire.moduleA.</span>getBuffer
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getBuffer() {
    return Buffer;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
expect(rewiredModuleB.getConsole()).not.to.be(consoleMock);
expect(console).not.to.be(consoleMock);
expect(rewiredModuleA.getFilename()).to.be(newFilename);
expect(rewiredModuleB.getFilename()).not.to.be(newFilename);
expect(console).not.to.be(newFilename);
if (typeof window === &#x22;undefined&#x22;) {
    rewiredModuleA.__set__(&#x22;Buffer&#x22;, bufferMock);
    expect(rewiredModuleA.<span class="apidocCodeKeywordSpan">getBuffer</span>()).to.be(bufferMock);
    expect(rewiredModuleB.getBuffer()).not.to.be(bufferMock);
    expect(Buffer).not.to.be(bufferMock);
} else {
    rewiredModuleA.__set__(&#x22;document&#x22;, documentMock);
    expect(rewiredModuleA.getDocument()).to.be(documentMock);
    expect(rewiredModuleB.getDocument() === documentMock).to.be(false);
    expect(document === documentMock).to.be(false);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.rewire.moduleA.getConsole" id="apidoc.element.rewire.moduleA.getConsole">
        function <span class="apidocSignatureSpan">rewire.moduleA.</span>getConsole
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getConsole() {
    return console;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    documentMock = {},
    newFilename = &#x22;myFile.js&#x22;;

rewiredModuleA.__set__({
    console: consoleMock,
    __filename: newFilename
});
expect(rewiredModuleA.<span class="apidocCodeKeywordSpan">getConsole</span>()).to.be(consoleMock);
expect(rewiredModuleB.getConsole()).not.to.be(consoleMock);
expect(console).not.to.be(consoleMock);
expect(rewiredModuleA.getFilename()).to.be(newFilename);
expect(rewiredModuleB.getFilename()).not.to.be(newFilename);
expect(console).not.to.be(newFilename);
if (typeof window === &#x22;undefined&#x22;) {
    rewiredModuleA.__set__(&#x22;Buffer&#x22;, bufferMock);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.rewire.moduleA.getDocument" id="apidoc.element.rewire.moduleA.getDocument">
        function <span class="apidocSignatureSpan">rewire.moduleA.</span>getDocument
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getDocument() {
    return document;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    if (typeof window === &#x22;undefined&#x22;) {
        rewiredModuleA.__set__(&#x22;Buffer&#x22;, bufferMock);
        expect(rewiredModuleA.getBuffer()).to.be(bufferMock);
        expect(rewiredModuleB.getBuffer()).not.to.be(bufferMock);
        expect(Buffer).not.to.be(bufferMock);
    } else {
        rewiredModuleA.__set__(&#x22;document&#x22;, documentMock);
        expect(rewiredModuleA.<span class="apidocCodeKeywordSpan">getDocument</span>()).to.be(documentMock);
        expect(rewiredModuleB.getDocument() === documentMock).to.be(false);
        expect(document === documentMock).to.be(false);
    }
});

it(&#x22;should be possible to mock global objects that are added on runtime&#x22;, function () {
    var rewiredModule;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.rewire.moduleA.getFilename" id="apidoc.element.rewire.moduleA.getFilename">
        function <span class="apidocSignatureSpan">rewire.moduleA.</span>getFilename
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getFilename() {
    return __filename;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
function checkForTypeError(err) {
expect(err.constructor).to.be(TypeError);
}

describe(&#x22;rewire &#x22; + (typeof testEnv === &#x22;undefined&#x22;? &#x22;(node)&#x22;: &#x22;(&#x22; + testEnv + &#x22;)&#
x22;), function () {

it(&#x22;should work like require()&#x22;, function () {
    rewire(&#x22;./moduleA.js&#x22;).<span class="apidocCodeKeywordSpan">getFilename</span>();
    require(&#x22;./moduleA.js&#x22;).getFilename();
    expect(rewire(&#x22;./moduleA.js&#x22;).getFilename()).to.eql(require(&#x22;./moduleA.js&#x22;).getFilename());
    expect(rewire(&#x22;../testLib/someOtherModule.js&#x22;).filename).to.eql(require(&#x22;../testLib/someOtherModule.js&#x22;).
filename);
});

it(&#x22;should return a fresh instance of the module&#x22;, function () {
    var someOtherModule = require(&#x22;./someOtherModule.js&#x22;),
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.rewire.moduleA.getMyNumber" id="apidoc.element.rewire.moduleA.getMyNumber">
        function <span class="apidocSignatureSpan">rewire.moduleA.</span>getMyNumber
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getMyNumber() {
    return myNumber;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

// This is just an integration test for the __set__ method
// You can find a full test for __set__ under /test/__set__.test.js
it(&#x22;should provide a working __set__ method&#x22;, function () {
    var rewiredModuleA = rewire(&#x22;./moduleA.js&#x22;),
        newObj = {};

    expect(rewiredModuleA.<span class="apidocCodeKeywordSpan">getMyNumber</span>()).to.be(0);
    rewiredModuleA.__set__(&#x22;myNumber&#x22;, 2);
    expect(rewiredModuleA.getMyNumber()).to.be(2);
    rewiredModuleA.__set__(&#x22;myObj&#x22;, newObj);
    expect(rewiredModuleA.getMyObj()).to.be(newObj);
    rewiredModuleA.__set__(&#x22;env&#x22;, &#x22;ENVENV&#x22;);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.rewire.moduleA.getMyObj" id="apidoc.element.rewire.moduleA.getMyObj">
        function <span class="apidocSignatureSpan">rewire.moduleA.</span>getMyObj
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getMyObj() {
    return myObj;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    var rewiredModuleA = rewire(&#x22;./moduleA.js&#x22;),
        newObj = {};

    expect(rewiredModuleA.getMyNumber()).to.be(0);
    rewiredModuleA.__set__(&#x22;myNumber&#x22;, 2);
    expect(rewiredModuleA.getMyNumber()).to.be(2);
    rewiredModuleA.__set__(&#x22;myObj&#x22;, newObj);
    expect(rewiredModuleA.<span class="apidocCodeKeywordSpan">getMyObj</span>()).to.be(newObj);
    rewiredModuleA.__set__(&#x22;env&#x22;, &#x22;ENVENV&#x22;);
});

// This is just an integration test for the __get__ method
// You can find a full test for __get__ under /test/__get__.test.js
it(&#x22;should provide a working __get__ method&#x22;, function () {
    var rewiredModuleA = rewire(&#x22;./moduleA.js&#x22;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.rewire.moduleA.readFileSync" id="apidoc.element.rewire.moduleA.readFileSync">
        function <span class="apidocSignatureSpan">rewire.moduleA.</span>readFileSync
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function readFileSync() {
    fs.readFileSync(&#x22;bla.txt&#x22;, &#x22;utf8&#x22;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
function restoreExtensions() {
    if (&#x22;coffee&#x22; in originalExtensions) {
        require.extensions[&#x22;.coffee&#x22;] = originalExtensions.coffee;
    }
}

function coffeeExtension(module, filename) {
    var content = stripBOM(fs.<span class="apidocCodeKeywordSpan">readFileSync</span>(filename, &#x22;utf8&#x22;));

    content = coffee.compile(content, {
        filename: filename,
        bare: true
    });
    module._compile(content, filename);
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.rewire.moduleA.setMyNumber" id="apidoc.element.rewire.moduleA.setMyNumber">
        function <span class="apidocSignatureSpan">rewire.moduleA.</span>setMyNumber
        <span class="apidocSignatureSpan">(newNumber)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function setMyNumber(newNumber) {
    myNumber = newNumber;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.rewire.moduleA.setMyObj" id="apidoc.element.rewire.moduleA.setMyObj">
        function <span class="apidocSignatureSpan">rewire.moduleA.</span>setMyObj
        <span class="apidocSignatureSpan">(newObj)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function setMyObj(newObj) {
    myObj = newObj;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>




</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.rewire.moduleB" id="apidoc.module.rewire.moduleB">module rewire.moduleB</a></h1>


    <h2>
        <a href="#apidoc.element.rewire.moduleB.checkSomeGlobals" id="apidoc.element.rewire.moduleB.checkSomeGlobals">
        function <span class="apidocSignatureSpan">rewire.moduleB.</span>checkSomeGlobals
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function checkSomeGlobals() {
    var isLowerIE,
        typeOfGlobalFunc;

    if (typeof navigator !== &#x22;undefined&#x22;) {
        isLowerIE = /MSIE [6-8]\.[0-9]/g.test(navigator.userAgent);
    }
    if (isLowerIE) {
        typeOfGlobalFunc = &#x22;object&#x22;;
    } else {
        typeOfGlobalFunc = &#x22;function&#x22;;
    }

    if (typeof global !== &#x22;object&#x22;) {
        throw new ReferenceError(&#x22;global is not an object&#x22;);
    }
    if (typeof console !== &#x22;object&#x22;) {
        throw new ReferenceError(&#x22;console is not an object&#x22;);
    }
    if (typeof require !== &#x22;function&#x22;) {
        throw new ReferenceError(&#x22;require is not a function&#x22;);
    }
    if (typeof module !== &#x22;object&#x22;) {
        throw new ReferenceError(&#x22;module is not an object&#x22;);
    }
    if (typeof exports !== &#x22;object&#x22;) {
        throw new ReferenceError(&#x22;exports is not an object&#x22;);
    }
    if (module.exports === exports) {
        throw new Error(&#x22;module.exports === exports returns true&#x22;);
    }
    if (typeof __dirname !== &#x22;string&#x22;) {
        throw new ReferenceError(&#x22;__dirname is not a string&#x22;);
    }
    if (typeof __filename !== &#x22;string&#x22;) {
        throw new ReferenceError(&#x22;__filename is not a string&#x22;);
    }
    if (typeof setTimeout !== typeOfGlobalFunc) {
        throw new ReferenceError(&#x22;setTimeout is not a function&#x22;);
    }
    if (typeof clearTimeout !== typeOfGlobalFunc) {
        throw new ReferenceError(&#x22;clearTimeout is not a function&#x22;);
    }
    if (typeof setInterval !== typeOfGlobalFunc) {
        throw new ReferenceError(&#x22;setInterval is not a function&#x22;);
    }
    if (typeof clearInterval !== typeOfGlobalFunc) {
        throw new ReferenceError(&#x22;clearInterval is not a function&#x22;);
    }
    if (typeof Error !== &#x22;function&#x22;) {
        throw new ReferenceError(&#x22;Error is not a function&#x22;);
    }
    if (typeof parseFloat !== &#x22;function&#x22;) {
        throw new ReferenceError(&#x22;parseFloat is not a function&#x22;);
    }
    if (typeof parseInt !== &#x22;function&#x22;) {
        throw new ReferenceError(&#x22;parseInt is not a function&#x22;);
    }
    if (typeof window === &#x22;undefined&#x22;) {
        if (typeof process !== &#x22;object&#x22;) {
            throw new ReferenceError(&#x22;process is not an object&#x22;);
        }
        if (typeof Buffer !== &#x22;function&#x22;) {
            throw new ReferenceError(&#x22;Buffer is not a function&#x22;);
        }
    } else {
        if (typeof encodeURIComponent !== &#x22;function&#x22;) {
            throw new ReferenceError(&#x22;encodeURIComponent is not a function&#x22;);
        }
        if (typeof decodeURIComponent !== &#x22;function&#x22;) {
            throw new ReferenceError(&#x22;decodeURIComponent is not a function&#x22;);
        }
        if (typeof document !== &#x22;object&#x22;) {
            throw new ReferenceError(&#x22;document is not an object&#x22;);
        }
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    expect(require(&#x22;./someOtherModule.js&#x22;).__set__).to.be(undefined);
    expect(require(&#x22;./someOtherModule.js&#x22;).__get__).to.be(undefined);
    expect(require(&#x22;./someOtherModule.js&#x22;).__with__).to.be(undefined);
});

it(&#x22;should not override/influence global objects by default&#x22;, function () {
    // This should throw no exception
    rewire(&#x22;./moduleA.js&#x22;).<span class="apidocCodeKeywordSpan">checkSomeGlobals</span>();
    rewire(&#x22;./moduleB.js&#x22;).checkSomeGlobals();
});

// This is just an integration test for the __set__ method
// You can find a full test for __set__ under /test/__set__.test.js
it(&#x22;should provide a working __set__ method&#x22;, function () {
    var rewiredModuleA = rewire(&#x22;./moduleA.js&#x22;),
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.rewire.moduleB.getBuffer" id="apidoc.element.rewire.moduleB.getBuffer">
        function <span class="apidocSignatureSpan">rewire.moduleB.</span>getBuffer
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getBuffer() {
    return Buffer;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
expect(rewiredModuleB.getConsole()).not.to.be(consoleMock);
expect(console).not.to.be(consoleMock);
expect(rewiredModuleA.getFilename()).to.be(newFilename);
expect(rewiredModuleB.getFilename()).not.to.be(newFilename);
expect(console).not.to.be(newFilename);
if (typeof window === &#x22;undefined&#x22;) {
    rewiredModuleA.__set__(&#x22;Buffer&#x22;, bufferMock);
    expect(rewiredModuleA.<span class="apidocCodeKeywordSpan">getBuffer</span>()).to.be(bufferMock);
    expect(rewiredModuleB.getBuffer()).not.to.be(bufferMock);
    expect(Buffer).not.to.be(bufferMock);
} else {
    rewiredModuleA.__set__(&#x22;document&#x22;, documentMock);
    expect(rewiredModuleA.getDocument()).to.be(documentMock);
    expect(rewiredModuleB.getDocument() === documentMock).to.be(false);
    expect(document === documentMock).to.be(false);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.rewire.moduleB.getConsole" id="apidoc.element.rewire.moduleB.getConsole">
        function <span class="apidocSignatureSpan">rewire.moduleB.</span>getConsole
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getConsole() {
    return console;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    documentMock = {},
    newFilename = &#x22;myFile.js&#x22;;

rewiredModuleA.__set__({
    console: consoleMock,
    __filename: newFilename
});
expect(rewiredModuleA.<span class="apidocCodeKeywordSpan">getConsole</span>()).to.be(consoleMock);
expect(rewiredModuleB.getConsole()).not.to.be(consoleMock);
expect(console).not.to.be(consoleMock);
expect(rewiredModuleA.getFilename()).to.be(newFilename);
expect(rewiredModuleB.getFilename()).not.to.be(newFilename);
expect(console).not.to.be(newFilename);
if (typeof window === &#x22;undefined&#x22;) {
    rewiredModuleA.__set__(&#x22;Buffer&#x22;, bufferMock);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.rewire.moduleB.getDocument" id="apidoc.element.rewire.moduleB.getDocument">
        function <span class="apidocSignatureSpan">rewire.moduleB.</span>getDocument
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getDocument() {
    return document;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    if (typeof window === &#x22;undefined&#x22;) {
        rewiredModuleA.__set__(&#x22;Buffer&#x22;, bufferMock);
        expect(rewiredModuleA.getBuffer()).to.be(bufferMock);
        expect(rewiredModuleB.getBuffer()).not.to.be(bufferMock);
        expect(Buffer).not.to.be(bufferMock);
    } else {
        rewiredModuleA.__set__(&#x22;document&#x22;, documentMock);
        expect(rewiredModuleA.<span class="apidocCodeKeywordSpan">getDocument</span>()).to.be(documentMock);
        expect(rewiredModuleB.getDocument() === documentMock).to.be(false);
        expect(document === documentMock).to.be(false);
    }
});

it(&#x22;should be possible to mock global objects that are added on runtime&#x22;, function () {
    var rewiredModule;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.rewire.moduleB.getFilename" id="apidoc.element.rewire.moduleB.getFilename">
        function <span class="apidocSignatureSpan">rewire.moduleB.</span>getFilename
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getFilename() {
    return __filename;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
function checkForTypeError(err) {
expect(err.constructor).to.be(TypeError);
}

describe(&#x22;rewire &#x22; + (typeof testEnv === &#x22;undefined&#x22;? &#x22;(node)&#x22;: &#x22;(&#x22; + testEnv + &#x22;)&#
x22;), function () {

it(&#x22;should work like require()&#x22;, function () {
    rewire(&#x22;./moduleA.js&#x22;).<span class="apidocCodeKeywordSpan">getFilename</span>();
    require(&#x22;./moduleA.js&#x22;).getFilename();
    expect(rewire(&#x22;./moduleA.js&#x22;).getFilename()).to.eql(require(&#x22;./moduleA.js&#x22;).getFilename());
    expect(rewire(&#x22;../testLib/someOtherModule.js&#x22;).filename).to.eql(require(&#x22;../testLib/someOtherModule.js&#x22;).
filename);
});

it(&#x22;should return a fresh instance of the module&#x22;, function () {
    var someOtherModule = require(&#x22;./someOtherModule.js&#x22;),
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.rewire.moduleB.getMyNumber" id="apidoc.element.rewire.moduleB.getMyNumber">
        function <span class="apidocSignatureSpan">rewire.moduleB.</span>getMyNumber
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getMyNumber() {
    return myNumber;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

// This is just an integration test for the __set__ method
// You can find a full test for __set__ under /test/__set__.test.js
it(&#x22;should provide a working __set__ method&#x22;, function () {
    var rewiredModuleA = rewire(&#x22;./moduleA.js&#x22;),
        newObj = {};

    expect(rewiredModuleA.<span class="apidocCodeKeywordSpan">getMyNumber</span>()).to.be(0);
    rewiredModuleA.__set__(&#x22;myNumber&#x22;, 2);
    expect(rewiredModuleA.getMyNumber()).to.be(2);
    rewiredModuleA.__set__(&#x22;myObj&#x22;, newObj);
    expect(rewiredModuleA.getMyObj()).to.be(newObj);
    rewiredModuleA.__set__(&#x22;env&#x22;, &#x22;ENVENV&#x22;);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.rewire.moduleB.getMyObj" id="apidoc.element.rewire.moduleB.getMyObj">
        function <span class="apidocSignatureSpan">rewire.moduleB.</span>getMyObj
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getMyObj() {
    return myObj;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    var rewiredModuleA = rewire(&#x22;./moduleA.js&#x22;),
        newObj = {};

    expect(rewiredModuleA.getMyNumber()).to.be(0);
    rewiredModuleA.__set__(&#x22;myNumber&#x22;, 2);
    expect(rewiredModuleA.getMyNumber()).to.be(2);
    rewiredModuleA.__set__(&#x22;myObj&#x22;, newObj);
    expect(rewiredModuleA.<span class="apidocCodeKeywordSpan">getMyObj</span>()).to.be(newObj);
    rewiredModuleA.__set__(&#x22;env&#x22;, &#x22;ENVENV&#x22;);
});

// This is just an integration test for the __get__ method
// You can find a full test for __get__ under /test/__get__.test.js
it(&#x22;should provide a working __get__ method&#x22;, function () {
    var rewiredModuleA = rewire(&#x22;./moduleA.js&#x22;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.rewire.moduleB.readFileSync" id="apidoc.element.rewire.moduleB.readFileSync">
        function <span class="apidocSignatureSpan">rewire.moduleB.</span>readFileSync
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function readFileSync() {
    fs.readFileSync(&#x22;bla.txt&#x22;, &#x22;utf8&#x22;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
function restoreExtensions() {
    if (&#x22;coffee&#x22; in originalExtensions) {
        require.extensions[&#x22;.coffee&#x22;] = originalExtensions.coffee;
    }
}

function coffeeExtension(module, filename) {
    var content = stripBOM(fs.<span class="apidocCodeKeywordSpan">readFileSync</span>(filename, &#x22;utf8&#x22;));

    content = coffee.compile(content, {
        filename: filename,
        bare: true
    });
    module._compile(content, filename);
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.rewire.moduleB.setMyNumber" id="apidoc.element.rewire.moduleB.setMyNumber">
        function <span class="apidocSignatureSpan">rewire.moduleB.</span>setMyNumber
        <span class="apidocSignatureSpan">(newNumber)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function setMyNumber(newNumber) {
    myNumber = newNumber;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.rewire.moduleB.setMyObj" id="apidoc.element.rewire.moduleB.setMyObj">
        function <span class="apidocSignatureSpan">rewire.moduleB.</span>setMyObj
        <span class="apidocSignatureSpan">(newObj)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function setMyObj(newObj) {
    myObj = newObj;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>




</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.rewire.moduleEnv" id="apidoc.module.rewire.moduleEnv">module rewire.moduleEnv</a></h1>


    <h2>
        <a href="#apidoc.element.rewire.moduleEnv.inject" id="apidoc.element.rewire.moduleEnv.inject">
        function <span class="apidocSignatureSpan">rewire.moduleEnv.</span>inject
        <span class="apidocSignatureSpan">(prelude, appendix)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function inject(prelude, appendix) {
    Module.wrapper[0] = moduleWrapper0 + prelude;
    Module.wrapper[1] = appendix + moduleWrapper1;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    // Check if the module uses the strict mode.
    // If so we must ensure that &#x22;use strict&#x22;; stays at the beginning of the module.
    src = fs.readFileSync(targetPath, &#x22;utf8&#x22;);
    if (detectStrictMode(src) === true) {
        prelude = &#x27; &#x22;use strict&#x22;; &#x27; + prelude;
    }

    moduleEnv.<span class="apidocCodeKeywordSpan">inject</span>(prelude, appendix);
    moduleEnv.load(targetModule);

    return targetModule.exports;
}

module.exports = internalRewire;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.rewire.moduleEnv.load" id="apidoc.element.rewire.moduleEnv.load">
        function <span class="apidocSignatureSpan">rewire.moduleEnv.</span>load
        <span class="apidocSignatureSpan">(targetModule)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function load(targetModule) {
    nodeRequire = targetModule.require;
    targetModule.require = requireProxy;
    currentModule = targetModule;

    registerExtensions();
    targetModule.load(targetModule.id);

    // This is only necessary if nothing has been required within the module
    reset();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

function load(targetModule) {
nodeRequire = targetModule.require;
targetModule.require = requireProxy;
currentModule = targetModule;

registerExtensions();
targetModule.<span class="apidocCodeKeywordSpan">load</span>(targetModule.id);

// This is only necessary if nothing has been required within the module
reset();
}

function reset() {
Module.wrapper[0] = moduleWrapper0;
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.rewire.strictModule" id="apidoc.module.rewire.strictModule">module rewire.strictModule</a></h1>


    <h2>
        <a href="#apidoc.element.rewire.strictModule.doSomethingUnstrict" id="apidoc.element.rewire.strictModule.doSomethingUnstrict">
        function <span class="apidocSignatureSpan">rewire.strictModule.</span>doSomethingUnstrict
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function doSomethingUnstrict() {
    var caller = arguments.callee.caller;   // this should throw an error as a proof that strict mode is on
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
expect(rewire(&#x22;./moduleA.js&#x22;)).not.to.be(rewire(&#x22;./moduleA.js&#x22;));
    });

    it(&#x22;should preserve the strict mode&#x22;, function () {
var strictModule = rewire(&#x22;./strictModule.js&#x22;);

expect(function () {
    strictModule.<span class="apidocCodeKeywordSpan">doSomethingUnstrict</span>();
}).to.throwException(checkForTypeError);
    });

    it(&#x22;should not modify line numbers in stack traces&#x22;, function () {
var throwError = rewire(&#x22;./throwError.js&#x22;);

if (process.env.running_under_istanbul === &#x22;1&#x22;) {
...</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
